{{>Common/header}}

<!-- Include Quill.js styles and scripts -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<link href="/assets/css/cssCustom.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>



{{>Common/top_container}}

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-content">

                <div class="container" style="color: white;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="page-content header-text">
                                <h2>Edita tu sección</h2>
                                {{#section}}
                                <!-- Form to edit section -->
                                <form action="/section/{{id}}/edit" method="post" enctype="multipart/form-data">
                                    <div class="form-group">
                                        <label for="userName">Title:</label>
                                        <input type="text" class="form-control" id="title" name="title"
                                            value="{{title}}" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="description">Descripción:</label>
                                        {{#description}}
                                        <div id="editor" class="quill-editor custom-editor" style="height: 200px;">
                                        </div> <!-- Contenedor para Quill-->
                                        <!--<textarea class="form-control" id="description" name="description" rows="10" required></textarea> -->
                                        <input type="hidden" id="description" name="description" value="{{description}}"
                                            required> <!-- Contenido que se mandará sanitizado-->
                                        {{/description}}

                                    </div>
                                    <div class="form-group mx-auto" class="d-flex justify-content-center">
                                        <label for="sectionImage">Foto de sección:</label>
                                        <input type="file" class="form-control file-input-small" id="sectionImage"
                                            name="newImage">
                                    </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button type="submit" class="btn btn-primary">Confirmar</button>
                            </div>
                            </form>
                            {{/section}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{>Common/bottom_container}}

<script>
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                ['clean']
            ]
        }
    });

    const hiddenInput = document.querySelector('#description');
    if (hiddenInput && hiddenInput.value) {
        const sanitized = DOMPurify.sanitize(hiddenInput.value);
        quill.clipboard.dangerouslyPasteHTML(sanitized); // Paste the sanitized content into the editor
    }

    const form = document.querySelector('form');
    form.addEventListener('submit', function (e) {
        const rawHtml = quill.root.innerHTML;
        const cleaned = DOMPurify.sanitize(rawHtml);

        if (quill.getText().trim().length === 0) {
            e.preventDefault();
            alert('La descripción no puede estar vacía');
            return;
        }

        document.getElementById('description').value = cleaned;
    });
    
</script>

{{>Common/footer}}